<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mesos 安装与使用 | Docker 从入门到实践</title>
    <meta name="generator" content="VuePress 1.4.1">
    <script>
  var _hmt = _hmt || [];
  (function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?81a3490c9cd141dbcf6d00bc18b6edae";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script>
    <script>
  (function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
  </script>
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.1b5c6595.css" as="style"><link rel="preload" href="/assets/js/app.0af75af5.js" as="script"><link rel="preload" href="/assets/js/2.df1ebd69.js" as="script"><link rel="preload" href="/assets/js/156.a5013bba.js" as="script"><link rel="prefetch" href="/assets/js/10.035e7287.js"><link rel="prefetch" href="/assets/js/100.3b991c39.js"><link rel="prefetch" href="/assets/js/101.7e35929b.js"><link rel="prefetch" href="/assets/js/102.575f60a4.js"><link rel="prefetch" href="/assets/js/103.465c4c29.js"><link rel="prefetch" href="/assets/js/104.c89ab434.js"><link rel="prefetch" href="/assets/js/105.9db64dc9.js"><link rel="prefetch" href="/assets/js/106.2d261aaa.js"><link rel="prefetch" href="/assets/js/107.f0d3fd99.js"><link rel="prefetch" href="/assets/js/108.c1a37818.js"><link rel="prefetch" href="/assets/js/109.828dece8.js"><link rel="prefetch" href="/assets/js/11.bd6924a1.js"><link rel="prefetch" href="/assets/js/110.8107d163.js"><link rel="prefetch" href="/assets/js/111.734c2dc7.js"><link rel="prefetch" href="/assets/js/112.04be37fd.js"><link rel="prefetch" href="/assets/js/113.c66c96ec.js"><link rel="prefetch" href="/assets/js/114.9ab3674a.js"><link rel="prefetch" href="/assets/js/115.43bf43af.js"><link rel="prefetch" href="/assets/js/116.db72248a.js"><link rel="prefetch" href="/assets/js/117.2dea484a.js"><link rel="prefetch" href="/assets/js/118.766e699f.js"><link rel="prefetch" href="/assets/js/119.93793754.js"><link rel="prefetch" href="/assets/js/12.a02d4ec3.js"><link rel="prefetch" href="/assets/js/120.764d21f6.js"><link rel="prefetch" href="/assets/js/121.6c43d0ed.js"><link rel="prefetch" href="/assets/js/122.0b326212.js"><link rel="prefetch" href="/assets/js/123.77e2f10d.js"><link rel="prefetch" href="/assets/js/124.23542ac4.js"><link rel="prefetch" href="/assets/js/125.36066e3d.js"><link rel="prefetch" href="/assets/js/126.3f2e5c1d.js"><link rel="prefetch" href="/assets/js/127.a589c7fa.js"><link rel="prefetch" href="/assets/js/128.9d22047a.js"><link rel="prefetch" href="/assets/js/129.4ee3bd52.js"><link rel="prefetch" href="/assets/js/13.7786fb79.js"><link rel="prefetch" href="/assets/js/130.bcebb98e.js"><link rel="prefetch" href="/assets/js/131.f6583417.js"><link rel="prefetch" href="/assets/js/132.51ec7815.js"><link rel="prefetch" href="/assets/js/133.274641bd.js"><link rel="prefetch" href="/assets/js/134.41dffc7b.js"><link rel="prefetch" href="/assets/js/135.d52f730f.js"><link rel="prefetch" href="/assets/js/136.17d4b873.js"><link rel="prefetch" href="/assets/js/137.f09d537f.js"><link rel="prefetch" href="/assets/js/138.5eb1218b.js"><link rel="prefetch" href="/assets/js/139.f9976160.js"><link rel="prefetch" href="/assets/js/14.f2ec7854.js"><link rel="prefetch" href="/assets/js/140.a71c2fc3.js"><link rel="prefetch" href="/assets/js/141.43efc70e.js"><link rel="prefetch" href="/assets/js/142.eb77dfef.js"><link rel="prefetch" href="/assets/js/143.48eb6637.js"><link rel="prefetch" href="/assets/js/144.0e7d6fdd.js"><link rel="prefetch" href="/assets/js/145.89ae3016.js"><link rel="prefetch" href="/assets/js/146.080fc896.js"><link rel="prefetch" href="/assets/js/147.4b8c4763.js"><link rel="prefetch" href="/assets/js/148.db85489f.js"><link rel="prefetch" href="/assets/js/149.d2f8e523.js"><link rel="prefetch" href="/assets/js/15.50cd3836.js"><link rel="prefetch" href="/assets/js/150.884328b0.js"><link rel="prefetch" href="/assets/js/151.5850efbc.js"><link rel="prefetch" href="/assets/js/152.7037558a.js"><link rel="prefetch" href="/assets/js/153.b1b4c5a7.js"><link rel="prefetch" href="/assets/js/154.85821804.js"><link rel="prefetch" href="/assets/js/155.c79180df.js"><link rel="prefetch" href="/assets/js/157.d1e7eb74.js"><link rel="prefetch" href="/assets/js/158.5112a6b6.js"><link rel="prefetch" href="/assets/js/159.7492c717.js"><link rel="prefetch" href="/assets/js/16.f825ada1.js"><link rel="prefetch" href="/assets/js/160.2f4805b2.js"><link rel="prefetch" href="/assets/js/161.36633c3d.js"><link rel="prefetch" href="/assets/js/162.bcfe13e1.js"><link rel="prefetch" href="/assets/js/163.c1d7f0f5.js"><link rel="prefetch" href="/assets/js/164.7e5cd0a8.js"><link rel="prefetch" href="/assets/js/165.b814e437.js"><link rel="prefetch" href="/assets/js/166.c452f93f.js"><link rel="prefetch" href="/assets/js/167.71c19d39.js"><link rel="prefetch" href="/assets/js/168.c7e798d2.js"><link rel="prefetch" href="/assets/js/169.4bfdc0ed.js"><link rel="prefetch" href="/assets/js/17.99c8e01d.js"><link rel="prefetch" href="/assets/js/170.4a8b2291.js"><link rel="prefetch" href="/assets/js/171.00172319.js"><link rel="prefetch" href="/assets/js/172.9bd58022.js"><link rel="prefetch" href="/assets/js/173.13140ea3.js"><link rel="prefetch" href="/assets/js/174.4da076e7.js"><link rel="prefetch" href="/assets/js/175.46d6a560.js"><link rel="prefetch" href="/assets/js/176.6a28d1f1.js"><link rel="prefetch" href="/assets/js/177.df25861b.js"><link rel="prefetch" href="/assets/js/178.f61f898a.js"><link rel="prefetch" href="/assets/js/179.e7d0f0cf.js"><link rel="prefetch" href="/assets/js/18.a46f0304.js"><link rel="prefetch" href="/assets/js/180.84906d12.js"><link rel="prefetch" href="/assets/js/181.341214fa.js"><link rel="prefetch" href="/assets/js/182.edd0c7a8.js"><link rel="prefetch" href="/assets/js/183.016846da.js"><link rel="prefetch" href="/assets/js/184.1f5066ef.js"><link rel="prefetch" href="/assets/js/185.16d5301e.js"><link rel="prefetch" href="/assets/js/186.85a8e691.js"><link rel="prefetch" href="/assets/js/187.9962ce64.js"><link rel="prefetch" href="/assets/js/188.b13ca221.js"><link rel="prefetch" href="/assets/js/189.f2feacbe.js"><link rel="prefetch" href="/assets/js/19.a45d0e92.js"><link rel="prefetch" href="/assets/js/190.8de53476.js"><link rel="prefetch" href="/assets/js/191.6e1d12c4.js"><link rel="prefetch" href="/assets/js/192.f8d26186.js"><link rel="prefetch" href="/assets/js/193.afeba75c.js"><link rel="prefetch" href="/assets/js/194.1476fb53.js"><link rel="prefetch" href="/assets/js/195.7e17a4a5.js"><link rel="prefetch" href="/assets/js/20.550af213.js"><link rel="prefetch" href="/assets/js/21.926e0689.js"><link rel="prefetch" href="/assets/js/22.050ba81c.js"><link rel="prefetch" href="/assets/js/23.1553f546.js"><link rel="prefetch" href="/assets/js/24.d4ba3e69.js"><link rel="prefetch" href="/assets/js/25.81944345.js"><link rel="prefetch" href="/assets/js/26.85a503d8.js"><link rel="prefetch" href="/assets/js/27.e789e154.js"><link rel="prefetch" href="/assets/js/28.bfaa1512.js"><link rel="prefetch" href="/assets/js/29.1d4847e3.js"><link rel="prefetch" href="/assets/js/3.875a4398.js"><link rel="prefetch" href="/assets/js/30.745501bf.js"><link rel="prefetch" href="/assets/js/31.5032f9bc.js"><link rel="prefetch" href="/assets/js/32.af7dfb97.js"><link rel="prefetch" href="/assets/js/33.f4740330.js"><link rel="prefetch" href="/assets/js/34.9bb8592b.js"><link rel="prefetch" href="/assets/js/35.a8fad05a.js"><link rel="prefetch" href="/assets/js/36.926636d6.js"><link rel="prefetch" href="/assets/js/37.89fee070.js"><link rel="prefetch" href="/assets/js/38.fc0ca195.js"><link rel="prefetch" href="/assets/js/39.153eff70.js"><link rel="prefetch" href="/assets/js/4.9583f7e1.js"><link rel="prefetch" href="/assets/js/40.a2b8eb57.js"><link rel="prefetch" href="/assets/js/41.18ba9903.js"><link rel="prefetch" href="/assets/js/42.ce7b6fd6.js"><link rel="prefetch" href="/assets/js/43.e3f52f45.js"><link rel="prefetch" href="/assets/js/44.457a37fd.js"><link rel="prefetch" href="/assets/js/45.a0111517.js"><link rel="prefetch" href="/assets/js/46.cc0769f4.js"><link rel="prefetch" href="/assets/js/47.cff2349c.js"><link rel="prefetch" href="/assets/js/48.806d4bba.js"><link rel="prefetch" href="/assets/js/49.12265f25.js"><link rel="prefetch" href="/assets/js/5.7156ee3c.js"><link rel="prefetch" href="/assets/js/50.09e24f18.js"><link rel="prefetch" href="/assets/js/51.a3ee971f.js"><link rel="prefetch" href="/assets/js/52.fd8592ac.js"><link rel="prefetch" href="/assets/js/53.fbba6d09.js"><link rel="prefetch" href="/assets/js/54.dc0c72bc.js"><link rel="prefetch" href="/assets/js/55.88e6628a.js"><link rel="prefetch" href="/assets/js/56.cec47644.js"><link rel="prefetch" href="/assets/js/57.eefad826.js"><link rel="prefetch" href="/assets/js/58.98ea494f.js"><link rel="prefetch" href="/assets/js/59.cf88088d.js"><link rel="prefetch" href="/assets/js/6.eab41f45.js"><link rel="prefetch" href="/assets/js/60.e35075dd.js"><link rel="prefetch" href="/assets/js/61.08b61062.js"><link rel="prefetch" href="/assets/js/62.0a40e949.js"><link rel="prefetch" href="/assets/js/63.8cd97f3d.js"><link rel="prefetch" href="/assets/js/64.2724daff.js"><link rel="prefetch" href="/assets/js/65.e9abaf8d.js"><link rel="prefetch" href="/assets/js/66.968e6db8.js"><link rel="prefetch" href="/assets/js/67.6b6411b7.js"><link rel="prefetch" href="/assets/js/68.51623250.js"><link rel="prefetch" href="/assets/js/69.515831b5.js"><link rel="prefetch" href="/assets/js/7.7cc3ce54.js"><link rel="prefetch" href="/assets/js/70.b255d141.js"><link rel="prefetch" href="/assets/js/71.60bd3cc3.js"><link rel="prefetch" href="/assets/js/72.32f5456a.js"><link rel="prefetch" href="/assets/js/73.3b2af45d.js"><link rel="prefetch" href="/assets/js/74.cf04f26e.js"><link rel="prefetch" href="/assets/js/75.7c9c7f2f.js"><link rel="prefetch" href="/assets/js/76.e646bd16.js"><link rel="prefetch" href="/assets/js/77.2fe62d2c.js"><link rel="prefetch" href="/assets/js/78.8c22965f.js"><link rel="prefetch" href="/assets/js/79.c2b9fda0.js"><link rel="prefetch" href="/assets/js/8.1e16424d.js"><link rel="prefetch" href="/assets/js/80.f0a863e8.js"><link rel="prefetch" href="/assets/js/81.c6baff8c.js"><link rel="prefetch" href="/assets/js/82.8c1d330f.js"><link rel="prefetch" href="/assets/js/83.8467bfd5.js"><link rel="prefetch" href="/assets/js/84.d31fe069.js"><link rel="prefetch" href="/assets/js/85.99ff59ab.js"><link rel="prefetch" href="/assets/js/86.aa90c9d1.js"><link rel="prefetch" href="/assets/js/87.acd04b77.js"><link rel="prefetch" href="/assets/js/88.9191e656.js"><link rel="prefetch" href="/assets/js/89.3b8f4b4c.js"><link rel="prefetch" href="/assets/js/9.afa9e5d0.js"><link rel="prefetch" href="/assets/js/90.e9ecc027.js"><link rel="prefetch" href="/assets/js/91.bd5b6a4e.js"><link rel="prefetch" href="/assets/js/92.244656ca.js"><link rel="prefetch" href="/assets/js/93.fc155ef0.js"><link rel="prefetch" href="/assets/js/94.54162338.js"><link rel="prefetch" href="/assets/js/95.0ef2b41e.js"><link rel="prefetch" href="/assets/js/96.8670541f.js"><link rel="prefetch" href="/assets/js/97.15883260.js"><link rel="prefetch" href="/assets/js/98.fbe43cd8.js"><link rel="prefetch" href="/assets/js/99.7f49cdfa.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1b5c6595.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Docker 从入门到实践</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/install/" class="nav-link">
  安装 Docker
</a></div><div class="nav-item"><a href="/" class="nav-link">
  Docker 入门
</a></div><div class="nav-item"><a href="/cases/os/" class="nav-link">
  Docker 实战
</a></div><div class="nav-item"><a href="/cases/ci/" class="nav-link">
  CI/CD
</a></div><div class="nav-item"><a href="/repository/" class="nav-link">
  Docker 仓库
</a></div><div class="nav-item"><a href="/underly/" class="nav-link">
  底层实现
</a></div><div class="nav-item"><a href="/compose/" class="nav-link">
  Compose
</a></div><div class="nav-item"><a href="/kubernetes/" class="nav-link">
  Kubernetes
</a></div><div class="nav-item"><a href="/cloud/" class="nav-link">
  云计算
</a></div><div class="nav-item"><a href="https://github.com/yeasy/docker_practice" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://cloud.tencent.com/redirect.php?redirect=10058&amp;cps_key=3a5255852d5db99dcd5da4c72f05df61" target="_blank" rel="noopener noreferrer" class="nav-link external">
  腾讯云容器服务
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/install/" class="nav-link">
  安装 Docker
</a></div><div class="nav-item"><a href="/" class="nav-link">
  Docker 入门
</a></div><div class="nav-item"><a href="/cases/os/" class="nav-link">
  Docker 实战
</a></div><div class="nav-item"><a href="/cases/ci/" class="nav-link">
  CI/CD
</a></div><div class="nav-item"><a href="/repository/" class="nav-link">
  Docker 仓库
</a></div><div class="nav-item"><a href="/underly/" class="nav-link">
  底层实现
</a></div><div class="nav-item"><a href="/compose/" class="nav-link">
  Compose
</a></div><div class="nav-item"><a href="/kubernetes/" class="nav-link">
  Kubernetes
</a></div><div class="nav-item"><a href="/cloud/" class="nav-link">
  云计算
</a></div><div class="nav-item"><a href="https://github.com/yeasy/docker_practice" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://cloud.tencent.com/redirect.php?redirect=10058&amp;cps_key=3a5255852d5db99dcd5da4c72f05df61" target="_blank" rel="noopener noreferrer" class="nav-link external">
  腾讯云容器服务
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" class="sidebar-link">Docker — 从入门到实践</a></li><li><a href="/CHANGELOG.html" class="sidebar-link">修订记录</a></li><li><a href="/CONTRIBUTING.html" class="sidebar-link">如何贡献</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Docker 简介</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/introduction/" class="sidebar-link">简介</a></li><li><a href="/introduction/what.html" class="sidebar-link">什么是 Docker</a></li><li><a href="/introduction/why.html" class="sidebar-link">为什么要使用 Docker？</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>基本概念</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic_concept/" class="sidebar-link">基本概念</a></li><li><a href="/basic_concept/image.html" class="sidebar-link">Docker 镜像</a></li><li><a href="/basic_concept/container.html" class="sidebar-link">Docker 容器</a></li><li><a href="/basic_concept/repository.html" class="sidebar-link">Docker Registry</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>使用镜像</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/image/" class="sidebar-link">使用 Docker 镜像</a></li><li><a href="/image/pull.html" class="sidebar-link">获取镜像</a></li><li><a href="/image/list.html" class="sidebar-link">列出镜像</a></li><li><a href="/image/rm.html" class="sidebar-link">删除本地镜像</a></li><li><a href="/image/commit.html" class="sidebar-link">利用 commit 理解镜像构成</a></li><li><a href="/image/build.html" class="sidebar-link">使用 Dockerfile 定制镜像</a></li><li><a href="/image/other.html" class="sidebar-link">其它制作镜像的方式</a></li><li><a href="/image/internal.html" class="sidebar-link">镜像的实现原理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Dockerfile</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/image/dockerfile/" class="sidebar-link">Dockerfile 指令详解</a></li><li><a href="/image/dockerfile/copy.html" class="sidebar-link">COPY 复制文件</a></li><li><a href="/image/dockerfile/add.html" class="sidebar-link">ADD 更高级的复制文件</a></li><li><a href="/image/dockerfile/cmd.html" class="sidebar-link">CMD 容器启动命令</a></li><li><a href="/image/dockerfile/entrypoint.html" class="sidebar-link">ENTRYPOINT 入口点</a></li><li><a href="/image/dockerfile/env.html" class="sidebar-link">ENV 设置环境变量</a></li><li><a href="/image/dockerfile/arg.html" class="sidebar-link">ARG 构建参数</a></li><li><a href="/image/dockerfile/volume.html" class="sidebar-link">VOLUME 定义匿名卷</a></li><li><a href="/image/dockerfile/expose.html" class="sidebar-link">EXPOSE 声明端口</a></li><li><a href="/image/dockerfile/workdir.html" class="sidebar-link">WORKDIR 指定工作目录</a></li><li><a href="/image/dockerfile/user.html" class="sidebar-link">USER 指定当前用户</a></li><li><a href="/image/dockerfile/healthcheck.html" class="sidebar-link">HEALTHCHECK 健康检查</a></li><li><a href="/image/dockerfile/onbuild.html" class="sidebar-link">ONBUILD 为他人做嫁衣裳</a></li><li><a href="/image/dockerfile/references.html" class="sidebar-link">参考文档</a></li><li><a href="/image/multistage-builds/" class="sidebar-link">多阶段构建</a></li><li><a href="/image/multistage-builds/laravel.html" class="sidebar-link">实战多阶段构建 Laravel 镜像</a></li><li><a href="/image/manifest.html" class="sidebar-link">构建多种系统架构支持的 Docker 镜像 -- docker manifest 命令详解</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>操作容器</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/container/" class="sidebar-link">操作 Docker 容器</a></li><li><a href="/container/run.html" class="sidebar-link">启动容器</a></li><li><a href="/container/daemon.html" class="sidebar-link">后台运行</a></li><li><a href="/container/stop.html" class="sidebar-link">终止容器</a></li><li><a href="/container/attach_exec.html" class="sidebar-link">进入容器</a></li><li><a href="/container/import_export.html" class="sidebar-link">导出和导入容器</a></li><li><a href="/container/rm.html" class="sidebar-link">删除容器</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>数据管理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/data_management/" class="sidebar-link">Docker 数据管理</a></li><li><a href="/data_management/volume.html" class="sidebar-link">数据卷</a></li><li><a href="/data_management/bind-mounts.html" class="sidebar-link">挂载主机目录</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>使用网络</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/network/" class="sidebar-link">Docker 中的网络功能介绍</a></li><li><a href="/network/port_mapping.html" class="sidebar-link">外部访问容器</a></li><li><a href="/network/linking.html" class="sidebar-link">容器互联</a></li><li><a href="/network/dns.html" class="sidebar-link">配置 DNS</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>高级网络配置</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/advanced_network/" class="sidebar-link">高级网络配置</a></li><li><a href="/advanced_network/quick_guide.html" class="sidebar-link">快速配置指南</a></li><li><a href="/advanced_network/access_control.html" class="sidebar-link">容器访问控制</a></li><li><a href="/advanced_network/port_mapping.html" class="sidebar-link">映射容器端口到宿主主机的实现</a></li><li><a href="/advanced_network/bridge.html" class="sidebar-link">自定义网桥</a></li><li><a href="/advanced_network/example.html" class="sidebar-link">工具和示例</a></li><li><a href="/advanced_network/config_file.html" class="sidebar-link">编辑网络配置文件</a></li><li><a href="/advanced_network/ptp.html" class="sidebar-link">示例：创建一个点到点连接</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Swarm mode</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/swarm_mode/" class="sidebar-link">Swarm mode</a></li><li><a href="/swarm_mode/overview.html" class="sidebar-link">基本概念</a></li><li><a href="/swarm_mode/create.html" class="sidebar-link">创建 Swarm 集群</a></li><li><a href="/swarm_mode/deploy.html" class="sidebar-link">部署服务</a></li><li><a href="/swarm_mode/stack.html" class="sidebar-link">在 Swarm 集群中使用 compose 文件</a></li><li><a href="/swarm_mode/secret.html" class="sidebar-link">在 Swarm 集群中管理敏感数据</a></li><li><a href="/swarm_mode/config.html" class="sidebar-link">在 Swarm 集群中管理配置数据</a></li><li><a href="/swarm_mode/rolling_update.html" class="sidebar-link">SWarm mode 与滚动升级</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>安全</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/security/" class="sidebar-link">安全</a></li><li><a href="/security/kernel_ns.html" class="sidebar-link">内核命名空间</a></li><li><a href="/security/control_group.html" class="sidebar-link">控制组</a></li><li><a href="/security/daemon_sec.html" class="sidebar-link">Docker服务端的防护</a></li><li><a href="/security/kernel_capability.html" class="sidebar-link">内核能力机制</a></li><li><a href="/security/other_feature.html" class="sidebar-link">其它安全特性</a></li><li><a href="/security/summary.html" class="sidebar-link">总结</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Docker Buildx</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/buildx/" class="sidebar-link">Docker Buildx</a></li><li><a href="/buildx/buildkit.html" class="sidebar-link">使用 BuildKit 构建镜像</a></li><li><a href="/buildx/buildx.html" class="sidebar-link">使用 Buildx 构建镜像</a></li><li><a href="/buildx/multi-arch-images.html" class="sidebar-link">使用 buildx 构建多种系统架构支持的 Docker 镜像</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Etcd</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/etcd/" class="sidebar-link">etcd</a></li><li><a href="/etcd/intro.html" class="sidebar-link">什么是 etcd</a></li><li><a href="/etcd/install.html" class="sidebar-link">安装</a></li><li><a href="/etcd/cluster.html" class="sidebar-link">etcd 集群</a></li><li><a href="/etcd/etcdctl.html" class="sidebar-link">使用 etcdctl</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Fedora CoreOS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/coreos/" class="sidebar-link">Fedora CoreOS</a></li><li><a href="/coreos/intro.html" class="sidebar-link">Fedora CoreOS 介绍</a></li><li><a href="/coreos/install.html" class="sidebar-link">安装 Fedora CoreOS</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Docker 开源项目</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/opensource/" class="sidebar-link">Docker 开源项目</a></li><li><a href="/opensource/linuxkit.html" class="sidebar-link">LinuxKit</a></li></ul></section></li><li><a href="/podman/" class="sidebar-link">podman</a></li><li><a href="/appendix/faq/" class="sidebar-link">常见问题总结</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>热门镜像介绍</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/appendix/repo/" class="sidebar-link">热门镜像介绍</a></li><li><a href="/appendix/repo/ubuntu.html" class="sidebar-link">Ubuntu</a></li><li><a href="/appendix/repo/centos.html" class="sidebar-link">CentOS</a></li><li><a href="/appendix/repo/nginx.html" class="sidebar-link">Nginx</a></li><li><a href="/appendix/repo/php.html" class="sidebar-link">PHP</a></li><li><a href="/appendix/repo/nodejs.html" class="sidebar-link">Node.js</a></li><li><a href="/appendix/repo/mysql.html" class="sidebar-link">MySQL</a></li><li><a href="/appendix/repo/wordpress.html" class="sidebar-link">WordPress</a></li><li><a href="/appendix/repo/mongodb.html" class="sidebar-link">MongoDB</a></li><li><a href="/appendix/repo/redis.html" class="sidebar-link">Redis</a></li><li><a href="/appendix/repo/minio.html" class="sidebar-link">minio</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Docker 命令</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/appendix/command/" class="sidebar-link">Docker 命令查询</a></li><li><a href="/appendix/command/docker.html" class="sidebar-link">客户端命令(docker)</a></li><li><a href="/appendix/command/dockerd.html" class="sidebar-link">服务端命令(dockerd)</a></li></ul></section></li><li><a href="/appendix/best_practices.html" class="sidebar-link">Dockerfile 最佳实践</a></li><li><a href="/appendix/debug.html" class="sidebar-link">如何调试 Docker</a></li><li><a href="/appendix/resources.html" class="sidebar-link">资源链接</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="mesos-安装与使用"><a href="#mesos-安装与使用" class="header-anchor">#</a> Mesos 安装与使用</h2> <p>以 Mesos 结合 Marathon 应用框架为例，来看下如何快速搭建一套 Mesos 平台。</p> <p>Marathon 是可以跟 Mesos 一起协作的一个 framework，基于 Scala 实现，可以实现保持应用的持续运行。</p> <p>另外，Mesos 默认利用 ZooKeeper 来进行多个主节点之间的选举，以及从节点发现主节点的过程。一般在生产环境中，需要启动多个 Mesos master 服务（推荐 3 或 5 个），并且推荐使用 supervisord 等进程管理器来自动保持服务的运行。</p> <p>ZooKeeper 是一个分布式集群中信息同步的工具，通过自动在多个节点中选举 <code>leader</code>，保障多个节点之间的某些信息保持一致性。</p> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <p>安装主要需要 mesos、zookeeper 和 marathon 三个软件包。</p> <p>Mesos 也采用了经典的主-从结构，一般包括若干主节点和大量从节点。其中，mesos master 服务和 zookeeper 需要部署到所有的主节点，mesos slave 服务需要部署到所有从节点。marathon 可以部署到主节点。</p> <p>安装可以通过源码编译、软件源或者 Docker 镜像方式进行，下面分别进行介绍。</p> <h4 id="源码编译"><a href="#源码编译" class="header-anchor">#</a> 源码编译</h4> <p>源码编译方式可以保障获取到最新版本，但编译过程比较费时间。</p> <p>首先，从 apache.org 开源网站下载最新的源码。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ <span class="token function">git</span> clone https://git-wip-us.apache.org/repos/asf/mesos.git
</code></pre></div><p>其中，主要代码在 <code>src</code> 目录下，应用框架代码在 <code>frameworks</code> 目录下，文档在 <code>docs</code> 目录下，<code>include</code> 中包括了跟 Mesos 打交道使用的一些 API 定义头文件。</p> <p>安装依赖，主要包括 Java 运行环境、Linux 上的自动编译环境等。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ <span class="token function">sudo</span> <span class="token function">apt-get</span> update
$ <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> -y openjdk-8-jdk autoconf libtool <span class="token punctuation">\</span>
build-essential python-dev python-boto libcurl4-nss-dev <span class="token punctuation">\</span>
libsasl2-dev maven libapr1-dev libsvn-dev
</code></pre></div><p>后面就是常规 C++ 项目的方法，configure 之后利用 Makefile 进行编译和安装。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ <span class="token builtin class-name">cd</span> mesos
$ ./bootstrap
$ <span class="token function">mkdir</span> build
$ <span class="token builtin class-name">cd</span> build <span class="token operator">&amp;&amp;</span> <span class="token punctuation">..</span>/configure --with-network-isolator
$ <span class="token function">make</span>
$ <span class="token function">make</span> check <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre></div><h4 id="软件源安装"><a href="#软件源安装" class="header-anchor">#</a> 软件源安装</h4> <p>通过软件源方式进行安装相对会省时间，但往往不是最新版本。</p> <p>这里以 Ubuntu 系统为例，首先添加软件源地址。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ <span class="token function">sudo</span> apt-key adv --keyserver keyserver.ubuntu.com --recv E56151BF
$ <span class="token assign-left variable">DISTRO</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>lsb_release -is <span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">'[:upper:]'</span> <span class="token string">'[:lower:]'</span><span class="token variable">)</span></span>
$ <span class="token assign-left variable">CODENAME</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>lsb_release -cs<span class="token variable">)</span></span>
$ <span class="token builtin class-name">echo</span> <span class="token string">&quot;deb http://repos.mesosphere.io/<span class="token variable">${DISTRO}</span> <span class="token variable">${CODENAME}</span> main&quot;</span> <span class="token operator">|</span> <span class="token punctuation">\</span>
<span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/sources.list.d/mesosphere.list
</code></pre></div><p>刷新本地软件仓库信息并安装 zookeeper、mesos、marathon 三个软件包。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ <span class="token function">sudo</span> <span class="token function">apt-get</span> -y update <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">apt-get</span> -y <span class="token function">install</span> zookeeper mesos marathon
</code></pre></div><p>注意，Marathon 最新版本需要 jdk 1.8+ 的支持。如果系统中有多个 Java 版本，需要检查配置默认的 JDK 版本符合要求。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ <span class="token function">sudo</span> update-alternatives --config java
</code></pre></div><p>安装 Mesos 成功后，会在 <code>/usr/sbin/</code> 下面发现 <code>mesos-master</code> 和 <code>mesos-slave</code> 两个二进制文件，分别对应主节点上需要运行的管理服务和从节点上需要运行的任务服务。</p> <p>用户可以手动运行二进制文件启动服务，也可以通过 <code>service</code> 命令来方便进行管理。</p> <p>例如，在主节点上重启 Mesos 管理服务：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ <span class="token function">sudo</span> <span class="token function">service</span> mesos-master restart
</code></pre></div><p>通过 <code>service</code> 命令来管理，实际上是通过调用 <code>/usr/bin/mesos-init-wrapper</code> 脚本文件进行处理。</p> <h4 id="基于-docker"><a href="#基于-docker" class="header-anchor">#</a> <a href="https://github.com/sekka1/mesosphere-docker" target="_blank" rel="noopener noreferrer">基于 Docker<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>需要如下三个镜像。</p> <ul><li>ZooKeeper：https://registry.hub.docker.com/u/garland/zookeeper/</li> <li>Mesos：https://registry.hub.docker.com/u/garland/mesosphere-docker-mesos-master/</li> <li>Marathon：https://registry.hub.docker.com/u/garland/mesosphere-docker-marathon/</li></ul> <p>其中 mesos-master 镜像在后面将分别作为 master 和 slave 角色进行使用。</p> <p>首先，拉取三个镜像。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ docker pull garland/zookeeper
$ docker pull garland/mesosphere-docker-mesos-master
$ docker pull garland/mesosphere-docker-marathon
</code></pre></div><p>导出主节点机器的地址到环境变量。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ <span class="token assign-left variable">HOST_IP</span><span class="token operator">=</span><span class="token number">10.0</span>.0.2
</code></pre></div><p>在主节点上启动 Zookeepr 容器。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>docker run -d <span class="token punctuation">\</span>
-p <span class="token number">2181</span>:2181 <span class="token punctuation">\</span>
-p <span class="token number">2888</span>:2888 <span class="token punctuation">\</span>
-p <span class="token number">3888</span>:3888 <span class="token punctuation">\</span>
garland/zookeeper
</code></pre></div><p>在主节点上启动 Mesos Master 服务容器。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>docker run --net<span class="token operator">=</span><span class="token string">&quot;host&quot;</span> <span class="token punctuation">\</span>
-p <span class="token number">5050</span>:5050 <span class="token punctuation">\</span>
-e <span class="token string">&quot;MESOS_HOSTNAME=<span class="token variable">${HOST_IP}</span>&quot;</span> <span class="token punctuation">\</span>
-e <span class="token string">&quot;MESOS_IP=<span class="token variable">${HOST_IP}</span>&quot;</span> <span class="token punctuation">\</span>
-e <span class="token string">&quot;MESOS_ZK=zk://<span class="token variable">${HOST_IP}</span>:2181/mesos&quot;</span> <span class="token punctuation">\</span>
-e <span class="token string">&quot;MESOS_PORT=5050&quot;</span> <span class="token punctuation">\</span>
-e <span class="token string">&quot;MESOS_LOG_DIR=/var/log/mesos&quot;</span> <span class="token punctuation">\</span>
-e <span class="token string">&quot;MESOS_QUORUM=1&quot;</span> <span class="token punctuation">\</span>
-e <span class="token string">&quot;MESOS_REGISTRY=in_memory&quot;</span> <span class="token punctuation">\</span>
-e <span class="token string">&quot;MESOS_WORK_DIR=/var/lib/mesos&quot;</span> <span class="token punctuation">\</span>
-d <span class="token punctuation">\</span>
garland/mesosphere-docker-mesos-master
</code></pre></div><p>在主节点上启动 Marathon。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>docker run <span class="token punctuation">\</span>
-d <span class="token punctuation">\</span>
-p <span class="token number">8080</span>:8080 <span class="token punctuation">\</span>
garland/mesosphere-docker-marathon --master zk://<span class="token variable">${HOST_IP}</span>:2181/mesos --zk zk://<span class="token variable">${HOST_IP}</span>:2181/marathon
</code></pre></div><p>在从节点上启动 Mesos slave 容器。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>docker run -d <span class="token punctuation">\</span>
--name mesos_slave_1 <span class="token punctuation">\</span>
--entrypoint<span class="token operator">=</span><span class="token string">&quot;mesos-slave&quot;</span> <span class="token punctuation">\</span>
-e <span class="token string">&quot;MESOS_MASTER=zk://<span class="token variable">${HOST_IP}</span>:2181/mesos&quot;</span> <span class="token punctuation">\</span>
-e <span class="token string">&quot;MESOS_LOG_DIR=/var/log/mesos&quot;</span> <span class="token punctuation">\</span>
-e <span class="token string">&quot;MESOS_LOGGING_LEVEL=INFO&quot;</span> <span class="token punctuation">\</span>
garland/mesosphere-docker-mesos-master:latest
</code></pre></div><p>接下来，可以通过访问本地 8080 端口来使用 Marathon 启动任务了。</p> <h3 id="配置说明"><a href="#配置说明" class="header-anchor">#</a> 配置说明</h3> <p>下面以本地通过软件源方式安装为例，解释如何修改各个配置文件。</p> <h4 id="zookeepr"><a href="#zookeepr" class="header-anchor">#</a> ZooKeepr</h4> <p>ZooKeepr 是一个分布式应用的协调工具，用来管理多个主节点的选举和冗余，监听在 2181 端口。推荐至少布置三个主节点来被 ZooKeeper 维护。</p> <p>配置文件默认都在 <code>/etc/zookeeper/conf/</code> 目录下。比较关键的配置文件有两个：<code>myid</code> 和 <code>zoo.cfg</code>。</p> <p>myid 文件会记录加入 ZooKeeper 集群的节点的序号（1-255之间）。<code>/var/lib/zookeeper/myid</code> 文件其实也是软连接到了该文件。</p> <p>比如配置某节点序号为 1，则需要在该节点上执行：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ <span class="token builtin class-name">echo</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">dd</span> <span class="token assign-left variable">of</span><span class="token operator">=</span>/etc/zookeeper/conf/myid
</code></pre></div><p>节点序号在 ZooKeeper 集群中必须唯一，不能出现多个拥有相同序号的节点。</p> <p>另外，需要修改 zoo.cfg 文件，该文件是主配置文件，主要需要添加上加入 ZooKeeper 集群的机器的序号和对应监听地址。</p> <p>例如，现在 ZooKeeper 集群中有三个节点，地址分别为 <code>10.0.0.2</code>、<code>10.0.0.3</code>、<code>10.0.0.4</code>，序号分别配置为 <code>2</code>、<code>3</code>、<code>4</code>。</p> <p>则配置如下的三行：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>server.2<span class="token operator">=</span><span class="token number">10.0</span>.0.2:2888:3888
server.3<span class="token operator">=</span><span class="token number">10.0</span>.0.3:2888:3888
server.4<span class="token operator">=</span><span class="token number">10.0</span>.0.4:2888:3888
</code></pre></div><p>其中第一个端口 2888 负责从节点连接到主节点的；第二个端口 3888 则负责主节点进行选举时候通信。</p> <p>也可以用主机名形式，则需要各个节点 <code>/etc/hosts</code> 文件中都记录地址到主机名对应的映射关系。</p> <p>完成配置后，启动 ZooKeeper 服务。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ <span class="token function">sudo</span> <span class="token function">service</span> zookeeper start
</code></pre></div><h4 id="mesos"><a href="#mesos" class="header-anchor">#</a> Mesos</h4> <p>Mesos 的默认配置目录有三个：</p> <ul><li>/etc/mesos/：主节点和从节点都会读取的配置文件，最关键的是 zk 文件存放主节点的信息；</li> <li>/etc/mesos-master/：只有主节点会读取的配置，等价于启动 mesos-master 命令时候的默认选项；</li> <li>/etc/mesos-slave/：只有从节点会读取的配置，等价于启动 mesos-master 命令时候的默认选项。</li></ul> <p>最关键的是需要在所有节点上修改 <code>/etc/mesos/zk</code>，写入主节点集群的 ZooKeeper 地址列表，例如：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>zk://10.0.0.2:2181,10.0.0.3:2181,10.0.0.4:2181/mesos
</code></pre></div><p>此外，<code>/etc/default/mesos</code>、<code>/etc/default/mesos-master</code>、<code>/etc/default/mesos-slave</code> 这三个文件中可以存放一些环境变量定义，Mesos 服务启动之前，会将这些环境变量导入进来作为启动参数。格式为 <code>MESOS_OPTION_NAME</code>。</p> <p>下面分别说明在主节点和从节点上的配置。</p> <h5 id="主节点"><a href="#主节点" class="header-anchor">#</a> 主节点</h5> <p>一般只需要关注 <code>/etc/mesos-master/</code> 目录下的文件。默认情况下目录下为空。</p> <p>该目录下文件命名和内容需要跟 mesos-master 支持的命令行选项一一对应。可以通过 <code>mesos-master --help</code> 命令查看支持的选项。</p> <p>例如某个文件 <code>key</code> 中内容为 <code>value</code>，则在 mesos-master 服务启动的时候，会自动添加参数 <code>--key=value</code> 给二进制命令。</p> <p>例如，mesos-master 服务默认监听在 loopback 端口，即 <code>127.0.0.1:5050</code>，我们需要修改主节点监听的地址，则可以创建 /etc/mesos-master/ip 文件，在其中写入主节点监听的外部地址。</p> <p>为了正常启动 mesos-master 服务，还需要指定 <code>work_dir</code> 参数(表示应用框架的工作目录)的值，可以通过创建 /etc/mesos-master/work_dir 文件，在其中写入目录，例如 <code>/var/lib/mesos</code>。工作目录下会生成一个 <code>replicated_log</code> 目录，会存有各种同步状态的持久化信息。</p> <p>以及指定 quorum 参数的值，该参数用来表示 ZooKeeper 集群中要求最少参加表决的节点数目。一般设置为比 ZooKeeper 集群中节点个数的半数多一些（比如三个节点的话，可以配置为 <code>2</code>）。</p> <p>此外，要修改 Mesos 集群的名称，可以创建 <code>/etc/mesos-master/cluster</code> 文件，在其中写入集群的别名，例如 <code>MesosCluster</code>。</p> <p>总结下，建议在 <code>/etc/mesos-master</code> 目录下，配置至少四个参数文件：<code>ip</code>、<code>quorum</code>、<code>work_dir</code>、<code>cluster</code>。</p> <p>修改配置之后，需要启动服务即可生效。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ <span class="token function">sudo</span> <span class="token function">service</span> mesos-master start
</code></pre></div><p>更多选项可以参考后面的配置项解析章节。</p> <p>主节点服务启动后，则可以在从节点上启动 mesos-slave 服务来加入主节点的管理。</p> <h5 id="从节点"><a href="#从节点" class="header-anchor">#</a> 从节点</h5> <p>一般只需要关注 <code>/etc/mesos-slave/</code> 目录下的文件。默认情况下目录下为空。</p> <p>文件命名和内容也是跟主节点类似，对应二进制文件支持的命令行参数。</p> <p>建议在从节点上，创建 <code>/etc/mesos-slave/ip</code> 文件，在其中写入跟主节点通信的地址。</p> <p>修改配置之后，也需要重新启动服务。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ <span class="token function">sudo</span> <span class="token function">service</span> mesos-slave start
</code></pre></div><p>更多选项可以参考后面的配置项解析章节。</p> <h4 id="marathon"><a href="#marathon" class="header-anchor">#</a> Marathon</h4> <p>Marathon 作为 Mesos 的一个应用框架，配置要更为简单，必需的配置项有 <code>--master</code> 和 <code>--zk</code>。</p> <p>安装完成后，会在 /usr/bin 下多一个 marathon shell 脚本，为启动 marathon 时候执行的命令。</p> <p>配置目录为 <code>/etc/marathon/conf</code>（需要手动创建），此外默认配置文件在 <code>/etc/default/marathon</code>。</p> <p>我们手动创建配置目录，并添加配置项（文件命名和内容跟 Mesos 风格一致），让 Marathon 能连接到已创建的 Mesos 集群中。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ <span class="token function">sudo</span> <span class="token function">mkdir</span> -p /etc/marathon/conf
$ <span class="token function">sudo</span> <span class="token function">cp</span> /etc/mesos/zk /etc/marathon/conf/master
</code></pre></div><p>同时，让 Marathon 也将自身的状态信息保存到 ZooKeeper 中。创建 <code>/etc/marathon/conf/zk</code> 文件，添加 ZooKeeper 地址和路径。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>zk://10.0.0.2:2181,10.0.0.2:2181,10.0.0.2:2181/marathon
</code></pre></div><p>启动 marathon 服务。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ <span class="token function">sudo</span> <span class="token function">service</span> marathon start
</code></pre></div><h3 id="访问-mesos-图形界面"><a href="#访问-mesos-图形界面" class="header-anchor">#</a> 访问 Mesos 图形界面</h3> <p>Mesos 自带了 Web 图形界面，可以方便用户查看集群状态。</p> <p>用户在 Mesos 主节点服务和从节点服务都启动后，可以通过浏览器访问主节点 5050 端口，看到类似如下界面，已经有两个 slave 节点加入了。</p> <p><img src="_images/mesos.png" alt="mesos 界面查看加入的 slave 节点"></p> <p>通过 Slaves 标签页能看到加入集群的从节点的信息。</p> <p>如果没有启动 Marathon 服务，在 Frameworks 标签页下将看不到任何内容。</p> <h3 id="访问-marathon-图形界面"><a href="#访问-marathon-图形界面" class="header-anchor">#</a> 访问 Marathon 图形界面</h3> <p>Marathon 服务启动成功后，在 Mesos 的 web 界面的 Frameworks 标签页下面将能看到名称为 marathon 的框架出现。</p> <p>同时可以通过浏览器访问 8080 端口，看到 Marathon 自己的管理界面。</p> <p><img src="_images/marathon.png" alt="marathon 图形管理界面"></p> <p>此时，可以通过界面或者 REST API 来创建一个应用，Marathon 会保持该应用的持续运行。</p> <p><img src="_images/marathon_basic0.png" alt="marathon 查看任务支持的参数"></p> <p>通过界面方式可以看到各任务支持的参数（包括资源、命令、环境变量、健康检查等），同时可以很容易地修改任务运行实例数进行扩展，非常适合进行测试。</p> <p>如果要更自动化地使用 Marathon，则需要通过它的 REST API 进行操作。</p> <p>一般的，启动新任务需要先创建一个定义模板（JSON 格式），然后发到指定的 API。</p> <p>例如，示例任务 basic-0 的定义模板为：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;basic-0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;cmd&quot;</span><span class="token operator">:</span> <span class="token string">&quot;while [ true ] ; do echo 'Hello Marathon' ; sleep 5 ; done&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;cpus&quot;</span><span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;mem&quot;</span><span class="token operator">:</span> <span class="token number">10.0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;instances&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre></div><p>该任务申请资源为 0.1 个单核 CPU 资源和 10 MB 的内存资源，具体命令为每隔五秒钟用 shell 打印一句 <code>Hello Marathon</code>。</p> <p>可以通过如下命令发出 basic-0 任务到 Marathon 框架，框架会分配任务到某个满足条件的从节点上，成功会返回一个 json 对象，描述任务的详细信息。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ <span class="token function">curl</span> -X POST http://marathon_host:8080/v2/apps -d @basic-0.json -H <span class="token string">&quot;Content-type: application/json&quot;</span>
<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;/basic-0&quot;</span>,<span class="token string">&quot;cmd&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;while [ true ] ; do echo 'Hello Marathon' ; sleep 5 ; done&quot;</span>,<span class="token string">&quot;args&quot;</span>:null,<span class="token string">&quot;user&quot;</span>:null,<span class="token string">&quot;env&quot;</span>:<span class="token punctuation">{</span><span class="token punctuation">}</span>,<span class="token string">&quot;instances&quot;</span>:1,<span class="token string">&quot;cpus&quot;</span>:0.1,<span class="token string">&quot;mem&quot;</span>:10,<span class="token string">&quot;disk&quot;</span>:0,<span class="token string">&quot;executor&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;&quot;</span>,<span class="token string">&quot;constraints&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">]</span>,<span class="token string">&quot;uris&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">]</span>,<span class="token string">&quot;storeUrls&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">]</span>,<span class="token string">&quot;ports&quot;</span>:<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>,<span class="token string">&quot;requirePorts&quot;</span>:false,<span class="token string">&quot;backoffSeconds&quot;</span>:1,<span class="token string">&quot;backoffFactor&quot;</span>:1.15,<span class="token string">&quot;maxLaunchDelaySeconds&quot;</span>:3600,<span class="token string">&quot;container&quot;</span>:null,<span class="token string">&quot;healthChecks&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">]</span>,<span class="token string">&quot;dependencies&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">]</span>,<span class="token string">&quot;upgradeStrategy&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;minimumHealthCapacity&quot;</span>:1,<span class="token string">&quot;maximumOverCapacity&quot;</span>:1<span class="token punctuation">}</span>,<span class="token string">&quot;labels&quot;</span>:<span class="token punctuation">{</span><span class="token punctuation">}</span>,<span class="token string">&quot;acceptedResourceRoles&quot;</span>:null,<span class="token string">&quot;version&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;2015-12-28T05:33:05.805Z&quot;</span>,<span class="token string">&quot;tasksStaged&quot;</span>:0,<span class="token string">&quot;tasksRunning&quot;</span>:0,<span class="token string">&quot;tasksHealthy&quot;</span>:0,<span class="token string">&quot;tasksUnhealthy&quot;</span>:0,<span class="token string">&quot;deployments&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;3ec3fbd5-11e4-479f-bd17-813d33e43e0c&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span>,<span class="token string">&quot;tasks&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span>%
</code></pre></div><p>Marathon 的更多 REST API 可以参考本地自带的文档：<code>http://marathon_host:8080/api-console/index.html</code>。</p> <p>此时，如果运行任务的从节点出现故障，任务会自动在其它可用的从节点上启动。</p> <p>此外，目前也已经支持基于 Docker 容器的任务。需要先在 Mesos slave 节点上为 slave 服务配置 <code>--containerizers=docker,mesos</code> 参数。</p> <p>例如如下面的示例任务：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;basic-3&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;cmd&quot;</span><span class="token operator">:</span> <span class="token string">&quot;python3 -m http.server 8080&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;cpus&quot;</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
  <span class="token property">&quot;mem&quot;</span><span class="token operator">:</span> <span class="token number">32.0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;container&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;DOCKER&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;volumes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;docker&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;image&quot;</span><span class="token operator">:</span> <span class="token string">&quot;python:3&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;network&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BRIDGE&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;portMappings&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;containerPort&quot;</span><span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>
            <span class="token property">&quot;hostPort&quot;</span><span class="token operator">:</span> <span class="token number">31000</span><span class="token punctuation">,</span>
            <span class="token property">&quot;servicePort&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tcp&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;privileged&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">&quot;parameters&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;forcePullImage&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>该任务启动一个 <code>python:3</code> 容器，执行 <code>python3 -m http.server 8080</code> 命令，作为一个简单的 web 服务，实际端口会映射到宿主机的 31000 端口。</p> <p>注意区分 hostPort 和 servicePort，前者代表任务映射到的本地可用端口（可用范围由 Mesos slave 汇报，默认为 31000 ~ 32000）；后者作为服务管理的端口，可以被用作一些服务发行机制使用进行转发，在整个 Marathon 集群中是唯一的。</p> <p>任务执行后，也可以在对应 slave 节点上通过 Docker 命令查看容器运行情况，容器将以 <code>mesos-SLAVE_ID</code> 开头。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ docker container <span class="token function">ls</span>
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                     NAMES
1226b4ec8d7d        python:3            <span class="token string">&quot;/bin/sh -c 'python3 &quot;</span>   <span class="token number">3</span> days ago          Up <span class="token number">3</span> days           <span class="token number">0.0</span>.0.0:10000-<span class="token operator">&gt;</span><span class="token number">8080</span>/tcp   mesos-06db0fba-49dc-4d28-ad87-6c2d5a020866-S10.b581149e-2c43-46a2-b652-1a0bc10204b3
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/yeasy/docker_practice/edit/master//mesos/installation.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0af75af5.js" defer></script><script src="/assets/js/2.df1ebd69.js" defer></script><script src="/assets/js/156.a5013bba.js" defer></script>
  </body>
</html>
