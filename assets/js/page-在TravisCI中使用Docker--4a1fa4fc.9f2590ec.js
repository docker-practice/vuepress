(window.webpackJsonp=window.webpackJsonp||[]).push([[125],{491:function(t,s,a){"use strict";a.r(s);var e=a(3),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"在-travis-ci-中使用-docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在-travis-ci-中使用-docker"}},[t._v("#")]),t._v(" 在 Travis CI 中使用 Docker")]),t._v(" "),a("p",[t._v("当代码提交到 GitHub 时，"),a("a",{attrs:{href:"https://travis-ci.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Travis CI"),a("OutboundLink")],1),t._v(" 会根据项目根目录 "),a("code",[t._v(".travis.yml")]),t._v(" 文件设置的指令，执行一系列操作。")]),t._v(" "),a("p",[t._v("本小节介绍如何在 Travis CI 中使用 Docker 进行持续集成/持续部署（CI/CD）。这里以当代码提交到 GitHub 时自动构建 Docker 镜像并推送到 Docker Hub 为例进行介绍。")]),t._v(" "),a("h2",{attrs:{id:"准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备"}},[t._v("#")]),t._v(" 准备")]),t._v(" "),a("p",[t._v("首先登录 https://travis-ci.com/account/repositories 选择 GitHub 仓库，按照指引安装 GitHub App 来启用 GitHub 仓库构建。")]),t._v(" "),a("p",[t._v("在项目根目录新建一个 "),a("code",[t._v("Dockerfile")]),t._v(" 文件。")]),t._v(" "),a("div",{staticClass:"language-docker extra-class"},[a("pre",{pre:!0,attrs:{class:"language-docker"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" alpine\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" echo "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello World"')]),t._v("\n")])])]),a("p",[t._v("新建 Travis CI 配置文件 "),a("code",[t._v(".travis.yml")]),t._v(" 文件。")]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("language")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" bash\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dist")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xenial\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" docker\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("before_script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 登录到 docker hub")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(' echo "$DOCKER_PASSWORD" '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" docker login "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('u "$DOCKER_USERNAME" '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("stdin\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 这里编写测试代码的命令")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(' echo "test code"\n\n'),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("after_success")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 当代码测试通过后执行的命令")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" docker build "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("t username/alpine .\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" docker push username/alpine\n")])])]),a("blockquote",[a("p",[t._v("请提前在 Travis CI 仓库设置页面配置 "),a("code",[t._v("DOCKER_PASSWORD")]),t._v(" "),a("code",[t._v("DOCKER_USERNAME")]),t._v(" 变量")])]),t._v(" "),a("h2",{attrs:{id:"查看结果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看结果"}},[t._v("#")]),t._v(" 查看结果")]),t._v(" "),a("p",[t._v("将项目推送到 GitHub，登录 "),a("a",{attrs:{href:"https://travis-ci.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Travis CI"),a("OutboundLink")],1),t._v(" 查看构建详情。")])])}),[],!1,null,null,null);s.default=n.exports}}]);