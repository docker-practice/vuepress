(window.webpackJsonp=window.webpackJsonp||[]).push([[100],{568:function(s,a,e){"use strict";e.r(a);var t=e(1),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"其它制作镜像的方式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#其它制作镜像的方式"}},[s._v("#")]),s._v(" 其它制作镜像的方式")]),s._v(" "),e("AdSenseTitle"),s._v(" "),e("p",[s._v("除了标准的使用 "),e("code",[s._v("Dockerfile")]),s._v(" 生成镜像的方法外，由于各种特殊需求和历史原因，还提供了一些其它方法用以生成镜像。")]),s._v(" "),e("h2",{attrs:{id:"从-rootfs-压缩包导入"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#从-rootfs-压缩包导入"}},[s._v("#")]),s._v(" 从 rootfs 压缩包导入")]),s._v(" "),e("p",[s._v("格式："),e("code",[s._v("docker import [选项] <文件>|<URL>|- [<仓库名>[:<标签>]]")])]),s._v(" "),e("p",[s._v("压缩包可以是本地文件、远程 Web 文件，甚至是从标准输入中得到。压缩包将会在镜像 "),e("code",[s._v("/")]),s._v(" 目录展开，并直接作为镜像第一层提交。")]),s._v(" "),e("p",[s._v("比如我们想要创建一个 "),e("a",{attrs:{href:"https://openvz.org",target:"_blank",rel:"noopener noreferrer"}},[s._v("OpenVZ"),e("OutboundLink")],1),s._v(" 的 Ubuntu 16.04 "),e("a",{attrs:{href:"https://wiki.openvz.org/Download/template/precreated",target:"_blank",rel:"noopener noreferrer"}},[s._v("模板"),e("OutboundLink")],1),s._v("的镜像：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    http://download.openvz.org/template/precreated/ubuntu-16.04-x86_64.tar.gz "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    openvz/ubuntu:16.04\n\nDownloading from http://download.openvz.org/template/precreated/ubuntu-16.04-x86_64.tar.gz\nsha256:412b8fc3e3f786dca0197834a698932b9c51b69bd8cf49e100c35d38c9879213\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("这条命令自动下载了 "),e("code",[s._v("ubuntu-16.04-x86_64.tar.gz")]),s._v(" 文件，并且作为根文件系统展开导入，并保存为镜像 "),e("code",[s._v("openvz/ubuntu:16.04")]),s._v("。")]),s._v(" "),e("p",[s._v("导入成功后，我们可以用 "),e("code",[s._v("docker image ls")]),s._v(" 看到这个导入的镜像：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" openvz/ubuntu\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nopenvz/ubuntu       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16.04")]),s._v("               412b8fc3e3f7        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v(" seconds ago      505MB\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("如果我们查看其历史的话，会看到描述中有导入的文件链接：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v(" openvz/ubuntu:16.04\nIMAGE               CREATED              CREATED BY          SIZE                COMMENT\nf477a6e18e98        About a minute ago                       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("214.9")]),s._v(" MB            Imported from http://download.openvz.org/template/precreated/ubuntu-16.04-x86_64.tar.gz\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h2",{attrs:{id:"docker-镜像的导入和导出-docker-save-和-docker-load"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-镜像的导入和导出-docker-save-和-docker-load"}},[s._v("#")]),s._v(" Docker 镜像的导入和导出 "),e("code",[s._v("docker save")]),s._v(" 和 "),e("code",[s._v("docker load")])]),s._v(" "),e("p",[s._v("Docker 还提供了 "),e("code",[s._v("docker save")]),s._v(" 和 "),e("code",[s._v("docker load")]),s._v(" 命令，用以将镜像保存为一个文件，然后传输到另一个位置上，再加载进来。这是在没有 Docker Registry 时的做法，现在已经不推荐，镜像迁移应该直接使用 Docker Registry，无论是直接使用 Docker Hub 还是使用内网私有 Registry 都可以。")]),s._v(" "),e("h3",{attrs:{id:"保存镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#保存镜像"}},[s._v("#")]),s._v(" 保存镜像")]),s._v(" "),e("p",[s._v("使用 "),e("code",[s._v("docker save")]),s._v(" 命令可以将镜像保存为归档文件。")]),s._v(" "),e("p",[s._v("比如我们希望保存这个 "),e("code",[s._v("alpine")]),s._v(" 镜像。")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" alpine\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nalpine              latest              baa5d63471ea        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" weeks ago         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.803")]),s._v(" MB\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("保存镜像的命令为：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" save alpine -o filename\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" filename\nfilename: POSIX "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" archive\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("这里的 filename 可以为任意名称甚至任意后缀名，但文件的本质都是归档文件")]),s._v(" "),e("p",[e("strong",[s._v("注意：如果同名则会覆盖（没有警告）")])]),s._v(" "),e("p",[s._v("若使用 "),e("code",[s._v("gzip")]),s._v(" 压缩：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" save alpine "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" alpine-latest.tar.gz\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("然后我们将 "),e("code",[s._v("alpine-latest.tar.gz")]),s._v(" 文件复制到了到了另一个机器上，可以用下面这个命令加载镜像：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" load -i alpine-latest.tar.gz\nLoaded image: alpine:latest\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("如果我们结合这两个命令以及 "),e("code",[s._v("ssh")]),s._v(" 甚至 "),e("code",[s._v("pv")]),s._v(" 的话，利用 Linux 强大的管道，我们可以写一个命令完成从一个机器将镜像迁移到另一个机器，并且带进度条的功能：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" save "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("镜像名"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bzip2")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("pv")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("用户名"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("@"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("主机名"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cat | docker load'")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])],1)}),[],!1,null,null,null);a.default=n.exports}}]);