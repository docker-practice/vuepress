(window.webpackJsonp=window.webpackJsonp||[]).push([[140],{341:function(s,a,e){"use strict";e.r(a);var t=e(0),r=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"使用-docker-容器部署-kubernetes"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用-docker-容器部署-kubernetes"}},[s._v("#")]),s._v(" 使用 Docker 容器部署 Kubernetes")]),s._v(" "),e("p",[s._v("最快速体验 Kubernetes 的方式就是在本地通过 Docker 的方式来启动相关进程。")]),s._v(" "),e("p",[s._v("下图展示了在单节点使用 Docker 快速部署一套 Kubernetes 的拓扑。")]),s._v(" "),e("p",[e("img",{attrs:{src:"_images/k8s-singlenode-docker.png",alt:"在 Docker 中启动 Kubernetes"}})]),s._v(" "),e("p",[s._v("Kubernetes 依赖 Etcd 服务来维护所有主节点的状态。")]),s._v(" "),e("h2",{attrs:{id:"启动-etcd-服务。"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动-etcd-服务。"}},[s._v("#")]),s._v(" 启动 Etcd 服务。")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("docker run --net"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("host -d gcr.io/google_containers/etcd:2.0.9 /usr/local/bin/etcd --addr"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:4001 --bind-addr"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:4001 --data-dir"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/etcd/data\n")])])]),e("h2",{attrs:{id:"启动主节点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动主节点"}},[s._v("#")]),s._v(" 启动主节点")]),s._v(" "),e("p",[s._v("启动 kubelet。")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("docker run --net"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("host -d -v /var/run/docker.sock:/var/run/docker.sock  gcr.io/google_containers/hyperkube:v0.17.0 /hyperkube kubelet --api_servers"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://localhost:8080 --v"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" --address"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 --enable_server --hostname_override"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 --config"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/manifests\n")])])]),e("h2",{attrs:{id:"启动服务代理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动服务代理"}},[s._v("#")]),s._v(" 启动服务代理")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("docker run -d --net"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("host --privileged gcr.io/google_containers/hyperkube:v0.17.0 /hyperkube proxy --master"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://127.0.0.1:8080 --v"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])])]),e("h2",{attrs:{id:"测试状态"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#测试状态"}},[s._v("#")]),s._v(" 测试状态")]),s._v(" "),e("p",[s._v("在本地访问 "),e("code",[s._v("8080")]),s._v(" 端口，可以获取到如下的结果：")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:8080\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"paths"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/api"')]),s._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/api/v1beta1"')]),s._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/api/v1beta2"')]),s._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/api/v1beta3"')]),s._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/healthz"')]),s._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/healthz/ping"')]),s._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/logs/"')]),s._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/metrics"')]),s._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/static/"')]),s._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/swagger-ui/"')]),s._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/swaggerapi/"')]),s._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/validate"')]),s._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/version"')]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),e("h2",{attrs:{id:"查看服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看服务"}},[s._v("#")]),s._v(" 查看服务")]),s._v(" "),e("p",[s._v("所有服务启动后，查看本地实际运行的 Docker 容器，有如下几个。")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("CONTAINER ID        IMAGE                                        COMMAND                CREATED             STATUS              PORTS               NAMES\nee054db2516c        gcr.io/google_containers/hyperkube:v0.17.0   "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/hyperkube schedule   2 days ago          Up 1 days                               k8s_scheduler.509f29c9_k8s-master-127.0.0.1_default_9941e5170b4365bd4aa91f122ba0c061_e97037f5\n3b0f28de07a2        gcr.io/google_containers/hyperkube:v0.17.0   "')]),s._v("/hyperkube apiserve   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" days ago          Up "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" days                               k8s_apiserver.245e44fa_k8s-master-127.0.0.1_default_9941e5170b4365bd4aa91f122ba0c061_6ab5c23d\n2eaa44ecdd8e        gcr.io/google_containers/hyperkube:v0.17.0   "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/hyperkube controll   2 days ago          Up 1 days                               k8s_controller-manager.33f83d43_k8s-master-127.0.0.1_default_9941e5170b4365bd4aa91f122ba0c061_1a60106f\n30aa7163cbef        gcr.io/google_containers/hyperkube:v0.17.0   "')]),s._v("/hyperkube proxy --   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" days ago          Up "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" days                               jolly_davinci\na2f282976d91        gcr.io/google_containers/pause:0.8.0         "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/pause"')]),s._v("               "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" days ago          Up "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" days                               k8s_POD.e4cc795_k8s-master-127.0.0.1_default_9941e5170b4365bd4aa91f122ba0c061_e8085b1f\nc060c52acc36        gcr.io/google_containers/hyperkube:v0.17.0   "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/hyperkube kubelet    2 days ago          Up 1 days                               serene_nobel\ncc3cd263c581        gcr.io/google_containers/etcd:2.0.9          "')]),s._v("/usr/local/bin/etcd   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" days ago          Up "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" days                               happy_turing\n")])])]),e("p",[s._v("这些服务大概分为三类：主节点服务、工作节点服务和其它服务。")]),s._v(" "),e("h3",{attrs:{id:"主节点服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#主节点服务"}},[s._v("#")]),s._v(" 主节点服务")]),s._v(" "),e("ul",[e("li",[e("p",[e("code",[s._v("apiserver")]),s._v(" 是整个系统的对外接口，提供 RESTful 方式供客户端和其它组件调用；")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("scheduler")]),s._v(" 负责对资源进行调度，分配某个 pod 到某个节点上；")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("controller-manager")]),s._v(" 负责管理控制器，包括 endpoint-controller（刷新服务和 pod 的关联信息）和 replication-controller（维护某个 pod 的复制为配置的数值）。")])])]),s._v(" "),e("h3",{attrs:{id:"工作节点服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#工作节点服务"}},[s._v("#")]),s._v(" 工作节点服务")]),s._v(" "),e("ul",[e("li",[e("p",[e("code",[s._v("kubelet")]),s._v(" 是工作节点执行操作的 agent，负责具体的容器生命周期管理，根据从数据库中获取的信息来管理容器，并上报 pod 运行状态等；")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("proxy")]),s._v(" 为 pod 上的服务提供访问的代理。")])])]),s._v(" "),e("h3",{attrs:{id:"其它服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#其它服务"}},[s._v("#")]),s._v(" 其它服务")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("Etcd 是所有状态的存储数据库；")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("gcr.io/google_containers/pause:0.8.0")]),s._v(" 是 Kubernetes 启动后自动 pull 下来的测试镜像。")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);