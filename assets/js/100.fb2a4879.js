(window.webpackJsonp=window.webpackJsonp||[]).push([[100],{448:function(t,e,s){"use strict";s.r(e);var a=s(42),v=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h3",{attrs:{id:"add-更高级的复制文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#add-更高级的复制文件"}},[t._v("#")]),t._v(" ADD 更高级的复制文件")]),t._v(" "),s("p",[s("code",[t._v("ADD")]),t._v(" 指令和 "),s("code",[t._v("COPY")]),t._v(" 的格式和性质基本一致。但是在 "),s("code",[t._v("COPY")]),t._v(" 基础上增加了一些功能。")]),t._v(" "),s("p",[t._v("比如 "),s("code",[t._v("<源路径>")]),t._v(" 可以是一个 "),s("code",[t._v("URL")]),t._v("，这种情况下，Docker 引擎会试图去下载这个链接的文件放到 "),s("code",[t._v("<目标路径>")]),t._v(" 去。下载后的文件权限自动设置为 "),s("code",[t._v("600")]),t._v("，如果这并不是想要的权限，那么还需要增加额外的一层 "),s("code",[t._v("RUN")]),t._v(" 进行权限调整，另外，如果下载的是个压缩包，需要解压缩，也一样还需要额外的一层 "),s("code",[t._v("RUN")]),t._v(" 指令进行解压缩。所以不如直接使用 "),s("code",[t._v("RUN")]),t._v(" 指令，然后使用 "),s("code",[t._v("wget")]),t._v(" 或者 "),s("code",[t._v("curl")]),t._v(" 工具下载，处理权限、解压缩、然后清理无用文件更合理。因此，这个功能其实并不实用，而且不推荐使用。")]),t._v(" "),s("p",[t._v("如果 "),s("code",[t._v("<源路径>")]),t._v(" 为一个 "),s("code",[t._v("tar")]),t._v(" 压缩文件的话，压缩格式为 "),s("code",[t._v("gzip")]),t._v(", "),s("code",[t._v("bzip2")]),t._v(" 以及 "),s("code",[t._v("xz")]),t._v(" 的情况下，"),s("code",[t._v("ADD")]),t._v(" 指令将会自动解压缩这个压缩文件到 "),s("code",[t._v("<目标路径>")]),t._v(" 去。")]),t._v(" "),s("p",[t._v("在某些情况下，这个自动解压缩的功能非常有用，比如官方镜像 "),s("code",[t._v("ubuntu")]),t._v(" 中：")]),t._v(" "),s("div",{staticClass:"language-docker extra-class"},[s("pre",{pre:!0,attrs:{class:"language-docker"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" scratch\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" ubuntu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("xenial"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("core"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cloudimg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("amd64"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("root.tar.gz /\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n")])])]),s("p",[t._v("但在某些情况下，如果我们真的是希望复制个压缩文件进去，而不解压缩，这时就不可以使用 "),s("code",[t._v("ADD")]),t._v(" 命令了。")]),t._v(" "),s("p",[t._v("在 Docker 官方的 "),s("RouterLink",{attrs:{to:"/appendix/best_practices.html"}},[t._v("Dockerfile 最佳实践文档")]),t._v(" 中要求，尽可能的使用 "),s("code",[t._v("COPY")]),t._v("，因为 "),s("code",[t._v("COPY")]),t._v(" 的语义很明确，就是复制文件而已，而 "),s("code",[t._v("ADD")]),t._v(" 则包含了更复杂的功能，其行为也不一定很清晰。最适合使用 "),s("code",[t._v("ADD")]),t._v(" 的场合，就是所提及的需要自动解压缩的场合。")],1),t._v(" "),s("p",[t._v("另外需要注意的是，"),s("code",[t._v("ADD")]),t._v(" 指令会令镜像构建缓存失效，从而可能会令镜像构建变得比较缓慢。")]),t._v(" "),s("p",[t._v("因此在 "),s("code",[t._v("COPY")]),t._v(" 和 "),s("code",[t._v("ADD")]),t._v(" 指令中选择的时候，可以遵循这样的原则，所有的文件复制均使用 "),s("code",[t._v("COPY")]),t._v(" 指令，仅在需要自动解压缩的场合使用 "),s("code",[t._v("ADD")]),t._v("。")]),t._v(" "),s("p",[t._v("在使用该指令的时候还可以加上 "),s("code",[t._v("--chown=<user>:<group>")]),t._v(" 选项来改变文件的所属用户及所属组。")]),t._v(" "),s("div",{staticClass:"language-docker extra-class"},[s("pre",{pre:!0,attrs:{class:"language-docker"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("chown=55"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("mygroup files* /mydir/\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("chown=bin files* /mydir/\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("chown=1 files* /mydir/\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("chown=10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("11 files* /mydir/\n")])])])])}),[],!1,null,null,null);e.default=v.exports}}]);