(window.webpackJsonp=window.webpackJsonp||[]).push([[184],{380:function(e,n,a){"use strict";a.r(n);var s=a(0),t=Object(s.a)({},(function(){var e=this,n=e.$createElement,a=e._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"swarm-mode-与滚动升级"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#swarm-mode-与滚动升级"}},[e._v("#")]),e._v(" SWarm mode 与滚动升级")]),e._v(" "),a("p",[e._v("在 "),a("RouterLink",{attrs:{to:"/swarm_mode/deploy.html"}},[e._v("部署服务")]),e._v(" 一节中我们使用 "),a("code",[e._v("nginx:1.13.7-alpine")]),e._v(" 镜像部署了一个名为 "),a("code",[e._v("nginx")]),e._v(" 的服务。")],1),e._v(" "),a("p",[e._v("现在我们想要将 "),a("code",[e._v("NGINX")]),e._v(" 版本升级到 "),a("code",[e._v("1.13.12")]),e._v("，那么在 Swarm mode 中如何升级服务呢？")]),e._v(" "),a("p",[e._v("你可能会想到，先停止原来的服务，再使用新镜像部署一个服务，不就完成服务的 “升级” 了吗。")]),e._v(" "),a("p",[e._v("这样做的弊端很明显，如果新部署的服务出现问题，原来的服务删除之后，很难恢复，那么在 Swarm mode 中到底该如何对服务进行滚动升级呢？")]),e._v(" "),a("p",[e._v("答案就是使用 "),a("code",[e._v("docker service update")]),e._v(" 命令。")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ docker "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("service")]),e._v(" update "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n    --image nginx:1.13.12-alpine "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n    nginx\n")])])]),a("p",[e._v("以上命令使用 "),a("code",[e._v("--image")]),e._v(" 选项更新了服务的镜像。当然我们也可以使用 "),a("code",[e._v("docker service update")]),e._v(" 更新任意的配置。")]),e._v(" "),a("p",[a("code",[e._v("--secret-add")]),e._v(" 选项可以增加一个密钥")]),e._v(" "),a("p",[a("code",[e._v("--secret-rm")]),e._v(" 选项可以删除一个密钥")]),e._v(" "),a("p",[e._v("更多选项可以通过 "),a("code",[e._v("docker service update -h")]),e._v(" 命令查看。")]),e._v(" "),a("h2",{attrs:{id:"服务回退"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务回退"}},[e._v("#")]),e._v(" 服务回退")]),e._v(" "),a("p",[e._v("现在假设我们发现 "),a("code",[e._v("nginx")]),e._v(" 服务的镜像升级到 "),a("code",[e._v("nginx:1.13.12-alpine")]),e._v(" 出现了一些问题，我们可以使用命令一键回退。")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ docker "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("service")]),e._v(" rollback nginx\n")])])]),a("p",[e._v("现在使用 "),a("code",[e._v("docker service ps")]),e._v(" 命令查看 "),a("code",[e._v("nginx")]),e._v(" 服务详情。")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ docker "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("service")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("ps")]),e._v(" nginx\n\nID                  NAME                IMAGE                  NODE                DESIRED STATE       CURRENT STATE                ERROR               PORTS\nrt677gop9d4x        nginx.1             nginx:1.13.7-alpine   VM-20-83-debian     Running             Running about a minute ago\nd9pw13v59d00         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("_ nginx.1         nginx:1.13.12-alpine  VM-20-83-debian     Shutdown            Shutdown "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v(" minutes ago\ni7ynkbg6ybq5         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("_ nginx.1         nginx:1.13.7-alpine   VM-20-83-debian     Shutdown            Shutdown "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v(" minutes ago\n")])])]),a("p",[e._v("结果的输出详细记录了服务的部署、滚动升级、回退的过程。")])])}),[],!1,null,null,null);n.default=t.exports}}]);